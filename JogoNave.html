<!DOCTYPE html>
<html lang="pt-br">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Invasores do Espaço</title>
		<style>
			/* Estilização do canvas */
			canvas {
				border: 1px solid red;
				display: block;
				margin: 0 auto;
				background-color: white;
			}
			body { 
				background-image: url("img/Fundo.jpg");
			}
			#start {
				background-color: green;
				width: 100px;
				height: 50px;
			}
			main{
				display: flex;
				justify-content: center;
				margin-top: 10px;
			}
			#stats{
				color: white;
			}
		</style>
	</head>
	<body>
		<canvas id="gameCanvas" width="800" height="700"></canvas>
		<main>
			<button id="start" onclick="desenhar(),criarInimigos(5)">Começar</button>
			<button id="start" onclick="cord()">Cord</button>
		</main>
		<div id="stats"></div>
		<audio id="somTiro" src="sounds/somTiro.wav"></audio>
		<audio id="somExplosao" src="sounds/somExplosao.wav"></audio>
		<audio id="somAmbiente" src="sounds/somAmbiente.wav"></audio>
		<script>
			// Obtendo o elemento canvas e seu contexto 2D
			const tela = document.getElementById("gameCanvas");
			const ctx = tela.getContext("2d");

			// Definição das constantes relacinadas às músicas
			const somTiro = document.getElementById("somTiro");
			const somExplosão = document.getElementById("somExplosao");
			const somAmbiente = document.getElementById("somAmbiente");
			
			// Definição das constantes relacionadas à nave do jogador
			const larguraNave = 80;
			const alturaNave = 60;
			const velocidadeNave = 20;
			const velocidadeTiro = 20;
			const tamanhoTiro = 6;

			// Definição das constantes relacionadas aos inimigos
			const larguraInimigo = 30;
			const alturaInimigo = 25;
			let velocidadeInimigo = 2;
			const inimigos = [];

			// Definição das constantes relacionadas ao Chefão1
			const larguraChefao1 = 400;
			const alturaChefao1 = 200;
			let velocidadeChefao1 = 2;
			const chefao1 = [];

			let posicaoChefao1X = tela.width / 2 - larguraChefao1 / 2;
			let posicaoChefao1Y = 100;


			// Variáveis de estado do jogo
			let posicaoNaveX = tela.width / 2 - larguraNave / 2;
			let posicaoTiroX = -10;
			let posicaoTiroY = -10;
			let tiroFoiDisparado = false;
			let acertos = 0;
			let erros = 0;
			let fimDeJogo = false;
			let novoNivel = true;
			let nivel = 1;

			// Elementos HTML para mostrar o nível e a velocidade
			const levelElement = document.getElementById('level');
    		const speedElement = document.getElementById('speed');

			// Event listener para capturar os eventos de teclado
			document.addEventListener('keydown', function(evento) {
				if (!fimDeJogo) {
					if (evento.key === 'ArrowLeft' && posicaoNaveX > 0) {
						posicaoNaveX -= velocidadeNave;
					} else if (evento.key === 'ArrowRight' && posicaoNaveX < tela.width - larguraNave) {
						posicaoNaveX += velocidadeNave;
					} else if (evento.key === ' ') {
						dispararTiro();
					}
        		}
   			});
			
			// Função para disparar um tiro
			function dispararTiro() {
				if (!tiroFoiDisparado) {
					posicaoTiroX = posicaoNaveX + larguraNave / 2 - tamanhoTiro / 2;
					posicaoTiroY = tela.height - alturaNave;
					somTiro.play();
					tiroFoiDisparado = true;
        		}
    		}

			// Função para disparar um tiro
			//function dispararTiroChefao1() {
		//		if (!tiroFoiDisparado) {
			//		posicaoTiroX = larguraChefao1 / 2 + posicaoChefao1X - tamanhoTiro / 2   ;
			//		posicaoTiroY = 300 ;
			//		somTiro.play();
			//		tiroFoiDisparado = true;
			//		
        	//	}
    		//}

			// Função para desenhar o tiro
			function desenharTiro() {
				if (tiroFoiDisparado) {
				ctx.fillStyle = 'red';
				ctx.fillRect(posicaoTiroX, posicaoTiroY, tamanhoTiro, tamanhoTiro);
        		}
    		}

			// Função para mover o tiro
			function moverTiro() {
				if (tiroFoiDisparado) {
					posicaoTiroY -= velocidadeTiro;
					if (posicaoTiroY < 0) {
						tiroFoiDisparado = false;
						erros++;
            		}
         		}
    		}	

			// Função para desenhar a nave
			function desenharNave() {
				var img = new Image();
				img.onload = () => {
					ctx.drawImage(img, posicaoNaveX, tela.height - alturaInimigo - 50, larguraNave, alturaNave);
				};
				img.src = "img/nave.png"
			}

			function desenharFundo(){
				// Carrega a imagem de fundo
				var imagemFundo = new Image();
				imagemFundo.onload = function () {
					// Define a imagem como padrão de preenchimento para o canvas
					var padraoFundo = ctx.createPattern(imagemFundo, "repeat");
					ctx.fillStyle = padraoFundo;
					ctx.fillRect(0, 0, tela.width, tela.height); // Preenche o canvas com a imagem de fundo
				};
				// Substitua 'caminho/para/sua/imagem.jpg' pelo caminho da sua imagem de fundo
				imagemFundo.src = "img/Fund02.png";
			}

			

			// Função para desenhar os inimigos
			function desenharInimigos() {
				ctx.fillStyle = 'red';
				inimigos.forEach(function(inimigo) {
					ctx.fillRect(inimigo.x, inimigo.y, larguraInimigo, alturaInimigo);
        		});
   			}

			// Função para desenhar o chefao
			function desenharChefao1() {
				ctx.fillStyle = 'red';
				chefao1.forEach(function(chefao) {
					ctx.fillRect(chefao.x, chefao.y, larguraChefao1, alturaChefao1);
        		});
   			}

			// Função para mover os inimigos
			function moverInimigos() {
				inimigos.forEach(function(inimigo) {
				inimigo.y += inimigo.velocidade;
					if (inimigo.y > tela.height) {
						inimigo.y = -alturaInimigo;
						inimigo.x = Math.random() * (tela.width - larguraInimigo);
					}
					if (inimigo.y + alturaInimigo > tela.height - alturaNave && 
						inimigo.x + larguraInimigo > posicaoNaveX && 
						inimigo.x < posicaoNaveX + larguraNave) {
						fimDeJogo = true;
						//alert('Fim de Jogo!');
					}
        		});
    		}

			// Função para mover o Chefão1
			function moverChefao1() {
				chefao1.forEach(function(chefao) {				
					chefao.y += chefao.velocidade;
					
					if(chefao.y == 100){					
						chefao.velocidade=0;
																		
					}
					//while(chefao.x == 0){
					//	dispararTiroChefao1();
					//}												
					
					if (chefao.y + alturaChefao1 > tela.height - alturaNave && 
						chefao.x + larguraChefao1 > posicaoNaveX && 
						chefao.x < posicaoNaveX + larguraNave) {
						fimDeJogo = true;
						//alert('Fim de Jogo!');
					}
					chefao.velocidade1 = 2;
					if (chefao.x <= 800 && chefao.y == 100){	
						chefao.x -= chefao.velocidade1;
						//alert(chefao.x);								
					}
					if (chefao.x == -400){
						chefao.x = 800;
					}
					
					//if (chefao.x ==0 && chefao.y == 100){
					//	moverD();
					//}
					//if (chefao.x > 200 && chefao.x < 400){
					//	chefao.x += velocidadeChefao1;
					//}
					
					
					
					//if (chefao.x >= 200 && chefao.x < 400 && chefao.y == 100) {
					//	chefao.x += chefao.velocidade1;	
					//}
					//if (chefao.x < 400 && chefao.x > 0 && chefao.y == 100){
					//	chefao.x -= chefao.velocidade1;
					//}
					//if (evento.key === 'ArrowLeft' && posicaoNaveX > 0) {
					//	posicaoNaveX -= velocidadeNave;
					//} else if (evento.key === 'ArrowRight' && posicaoNaveX < tela.width - larguraNave) {
					//	posicaoNaveX += velocidadeNave;
					
        		});
				
    		}

			function cord(){
				alert(posicaoChefao1X);
				alert(posicaoChefao1Y);
			}

			//function moverD(){
				
			//		chefao.x+= vchefao.velocidade1;
				
			//}

			function moverE(){
				
			}

						
	// Função para detectar colisões entre os tiros e os inimigos
    function detectarColisao() {
		
        inimigos.forEach(function(inimigo, indice) {
            if (posicaoTiroX < inimigo.x + larguraInimigo &&
                posicaoTiroX + tamanhoTiro > inimigo.x &&
                posicaoTiroY < inimigo.y + alturaInimigo &&
                posicaoTiroY + tamanhoTiro > inimigo.y) {
                inimigos.splice(indice, 1);
                tiroFoiDisparado = false;
                somExplosão.play();
				acertos++;
				
            }
        });
    }

	function detectarColisaoChefao1() {
		
		chefao1.forEach(function(chefao, indice) {
            if(acertos == 500){
				chefao.splice(indice, 1);
			}else if(posicaoTiroX < chefao.x + larguraChefao1 &&
                	posicaoTiroX + tamanhoTiro > chefao.x &&
                	posicaoTiroY < chefao.y + alturaChefao1 &&
                	posicaoTiroY + tamanhoTiro > chefao.y){			  																	
						tiroFoiDisparado = true;
						somExplosão.play();
						acertos++;				            
			 	}
        });
    }

	// Função para criar inimigos
	function criarInimigos(numero) {
				for (let i = 0; i < numero; i++) {
					inimigos.push({
						x: Math.random() * (tela.width - larguraInimigo),
						y: -alturaInimigo,
						velocidade: velocidadeInimigo
            		});
        		}
    		}

	// Função para criar chefao1
	function criarChefao1(numero){
		
		for (let i = 0; i < numero; i++) {
					chefao1.push({
						x: (tela.width - larguraChefao1) / 2,
						y: -alturaChefao1,
						velocidade: velocidadeChefao1
            		});
        		}
	}

			function disable(){
				document.getElementById("start").disabled = true;
			}

			// Função principal para desenhar o jogo
			function desenhar() {
				desenharFundo();
				desenharNave();
				desenharTiro();
				moverTiro();
				desenharInimigos();
				//desenharChefao1();
				moverInimigos();
				//moverChefao1();
				detectarColisao();
				//detectarColisaoChefao1();
				
				disable();
				document.getElementById("stats").innerHTML = `Acertos: ${acertos} | Erros: ${erros} <br> Nivel: ${nivel}<br> Velocidade inimigo: ${velocidadeInimigo}  `;
				// Cria novos inimigos a cada múltiplo de 5 acertos
				if (acertos % 5 === 0 && acertos > 0 && novoNivel) {
					nivel++;
					//levelElement.textContent = `Nível: ${nivel}`;
					criarInimigos(5);
					velocidadeInimigo += 1; // Aumenta a velocidade dos inimigos
					//speedElement.textContent = `Velocidade: ${velocidadeInimigo}`;
					novoNivel = false;
        		}
				if (nivel==5){
				desenharFundo();
				desenharNave();
				desenharTiro();
				moverTiro();
				desenharChefao1();
				moverChefao1();
				detectarColisaoChefao1();
				}
				if (inimigos.length === 0) {
					novoNivel = true; // Define como verdadeiro para criar novos inimigos no próximo nível
				}
				// Continua desenhando o jogo enquanto o jogo não acabar
				if (!fimDeJogo) {
					requestAnimationFrame(desenhar);
				}else{
					//ctx.clearRect(0, 0, tela.width, tela.height);
					document.getElementById("start").disabled = false;
					//alert("Fim de Jogo!");
				}
			}

		   

		</script>
	</body>
</html>
